@model RideShareFrontend.DTOs.RideBookingCreateViewModel


<div class="modal fade" id="bookRideModal" tabindex="-1" aria-labelledby="bookRideModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="BookRide"  method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookRideModalLabel">Book Ride</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label asp-for="RideId" class="form-label"></label>
                        <input asp-for="RideId" class="form-control" />
                        <span asp-validation-for="RideId" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="SeatsBooked" class="form-label">Seats (Should not be more than Available seats)</label>
                        <input asp-for="SeatsBooked" class="form-control" />
                        <span asp-validation-for="SeatsBooked" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="TotalAmount" class="form-label"></label>
                        <input asp-for="TotalAmount" class="form-control"  />
                        <span asp-validation-for="TotalAmount" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="PickupPoint" class="form-label"></label>
                        <input asp-for="PickupPoint" class="form-control" />
                        <span asp-validation-for="PickupPoint" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="DropPoint" class="form-label"></label>
                        <input asp-for="DropPoint" class="form-control" />
                        <span asp-validation-for="DropPoint" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="PassengerNotes" class="form-label"></label>
                        <textarea asp-for="PassengerNotes" class="form-control"></textarea>
                        <span asp-validation-for="PassengerNotes" class="text-danger"></span>
                    </div>

                    <!-- Optional Fields -->
                    @* <input asp-for="BookingStatus" type="hidden" value="Pending" /> *@
                    @* <input asp-for="BookingTime" type="hidden" value="@DateTime.Now" /> *@
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Confirm Booking</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* 
<script>
    const rides = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RideResults));

    console.log(rides);
    function renderRides(filteredRides) {
        const tbody = document.getElementById('rideResultsBody');
        tbody.innerHTML = "";

        if (!filteredRides.length) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center">No rides found for the selected filter.</td></tr>`;
            return;
        }

        filteredRides.forEach(ride => {
            const row = `
                                                                        <tr>
                                                                            <td>${ride.driverName || " "}</td>
                                                                            <td>${ride.Origin}</td>
                                                                            <td>${ride.Destination}</td>
                                                                            <td>${new Date(ride.DepartureTime).toLocaleString()}</td>
                                                                            <td class="text-center">${ride.AvailableSeats}</td>
                                                                            <td class="text-end">${parseFloat(ride.PricePerSeat).toFixed(2)}</td>
                                                                             <td class="text-center">
                                                                                               <button class="btn btn-sm btn-success" onclick="openBookRideModal('${ride.RideId}', '${ride.PricePerSeat}')">Book Ride</button>

                                                                            </td>
                                                                        </tr>
                                                                    `;
            tbody.innerHTML += row;
        });
    }

    renderRides(rides);

    document.getElementById("filterButton").addEventListener("click", () => {
        const min = parseFloat(document.getElementById("minPrice").value) || 0;
        const max = parseFloat(document.getElementById("maxPrice").value) || Infinity;

        const filtered = rides
            .filter(r => r.PricePerSeat >= min && r.PricePerSeat <= max)
            .sort((a, b) => a.PricePerSeat - b.PricePerSeat);

        renderRides(filtered);
    });
</script> *@

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">